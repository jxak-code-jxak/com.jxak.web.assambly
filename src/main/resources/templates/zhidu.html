<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" th:href="@{/plugins/layui/css/layui.css}">
    <style>
        .bottomLine {
            border-bottom: 1px solid #f6f6f6;
        }
    </style>
</head>
<body>
<div class="layui-container">
    <div class="layui-row">
        <div class="layui-col-xs3">
            <div class="layui-card">
                <div class="layui-card-header"><button id="fileUploads" class="layui-btn">导入<span class="layui-badge-dot layui-bg-orange"></span>
                </button>
                    <button id="downloadFile" type="button" class="layui-btn">导出<span class="layui-badge-dot layui-bg-orange"></span></button></div>
                <ul id="fileList" class="layui-card-body">
                </ul>
            </div>
        </div>
        <div class="layui-col-xs9">
            <div style=" width: 100%; height: 100%;">
                <embed src="/preview?pdfFilePath=C:/upload/廖远杰个人简历.pdf"
                       type="application/pdf" style="overflow: auto; width: 100%; height: 800px;" />
            </div>
        </div>
    </div>
</div>
<script th:src="@{/plugins/layui/layui.js}"></script>
<script src="http://jhyt.oss-cn-shanghai.aliyuncs.com/images/1531367199089_PDFObject.js"></script>
<script>
    layui.use('upload', function () {
        var $ = layui.jquery
            , upload = layui.upload;
        //指定允许上传的文件类型
        upload.render({
            elem: '#fileUploads'
            , url: '/file/upload/'
            , accept: 'file'
            , auto: true
            , done: function (res) {
                if (res.state) {
                    zhidu.getFileList();
                }
            }, error: function (res) {
                alert(JSON.stringify(res));
            }
        });

        var zhidu = {
            getFileList: function () {
                $.get("/file/getFileList", function (ret) {
                    var dataList = ret.data;
                    $("#fileList>").remove();
                    for (var i = 0; i < dataList.length; i++) {
                        var $li = $("<li style='cursor: pointer' class=\"bottomLine\">\n" +
                            "                        <div class=\"layui-row\">\n" +
                            "                            <div class=\"layui-col-xs2\">\n" +
                            "                                <input id="+dataList[i].id+" type=\"radio\" name=\"fileSelect\">\n" +
                            "                            </div>\n" +
                            "                            <div class=\"layui-col-xs10\">\n" +
                            "                                    <span name=\"uploadTime\"></span><br>\n" +
                            "                                <span name=\"filename\"></span>\n" +
                            "                            </div>\n" +
                            "                        </div>\n" +
                            "                    </li>");
                        $li.find("span[name='uploadTime']").text(dataList[i].uploadTime);
                        $li.find("span[name='filename']").text(dataList[i].filename);
                        $("#fileList").append($li);
                    }
                });
            },
            downloadFile:function () {
                //当前选中文件的Id
                var id = $("input[name='fileSelect']:checked").attr("id");
                if (id==undefined){
                    alert("请选择文件");
                    return;
                }
                $.get("/fileExist/"+id,function (ret) {
                   if (ret.state){
                       var form=$("<form>");
                       form.attr("style","display:none");
                       form.attr("target","");
                       form.attr("method","post");//提交方式为post
                       form.attr("action","/download/"+ret.data.filename);//定义action
                       $("body").append(form);
                       form.submit();
                   }
                });
            }
        };
        $("#downloadFile").click(function () {
            zhidu.downloadFile();
        });
        zhidu.getFileList();
    });

    /**
     * 刷新数据；列表
     */
    function loadList() {

    }
</script>
</body>
</html>
